rules:
  - id: test
    languages:
      - php
    severity: ERROR
    message: Semgrep found a match
    pattern-either:
      - patterns:
          - patterns:
              - pattern: add_action($HOOK,'$NAME')
              - focus-metavariable: $HOOK
          - metavariable-pattern:
              metavariable: $HOOK
              pattern-regex: "'wp_ajax.*'"
      - patterns:
          - patterns:
              - pattern: add_action($HOOK,...)
              - focus-metavariable: $HOOK
          - metavariable-pattern:
              metavariable: $HOOK
              pattern-regex: "'wp_ajax.*'"
      - patterns:
          - patterns:
              - pattern-inside: |-
                  function $FUNC(...){
                  ...
                  }
              - patterns:
                  - patterns:
                      - pattern: $METHOD["$ARG"]
                  - focus-metavariable: $METHOD
                  - metavariable-pattern:
                      metavariable: $METHOD
                      pattern-regex: \$_(REQUEST|POST|FILES|GET)
              - metavariable-pattern:
                  metavariable: $FUNC
                  pattern: $NAME
